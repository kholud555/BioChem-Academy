<!-- Add Unit Form -->
<div class="container-custom">
  <div class="card p-3 mt-4 border">
    <h5>Add New Unit</h5>

    <!-- Select Subject -->
    <div class="mb-2">
      <label>Select Subject</label>
      <select 
        class="form-control"
        [(ngModel)]="addModel.subjectId"
        (ngModelChange)="onSubjectChange()">
        <option value="0" disabled>Select Subject</option>
        <option *ngFor="let sub of subjects" [value]="sub.id">
          {{ sub.subjectName }}
        </option>
      </select>
    </div>

    <!-- Select Grade -->
    <div class="mb-2">
      <label>Select Grade</label>
      <select
        class="form-control"
        [(ngModel)]="addModel.gradeId"
        (ngModelChange)="onGradeChange()">
        <option value="0" disabled>Select Grade</option>
        <option *ngFor="let grade of grades" [value]="grade.id">
          {{ grade.gradeName }}
        </option>
      </select>
    </div>

    <!-- Select Term -->
    <div class="mb-2">
      <label>Select Term</label>
      <select
        class="form-control"
        [(ngModel)]="addModel.termId">
        <option value="0" disabled>Select Term</option>
        <option *ngFor="let term of terms" [value]="term.id">
          {{ term.termOrder === 0 ? 'First Term' : 'Second Term' }}
        </option>
      </select>
    </div>

    <!-- Unit Name -->
    <div class="mb-2">
      <label>Unit Title</label>
      <input
        type="text"
        class="form-control"
        [(ngModel)]="addModel.title"
        placeholder="Enter Unit Title"
      />
    </div>

    <!-- Description -->
    <div class="mb-2">
      <label>Description</label>
      <textarea
        class="form-control"
        [(ngModel)]="addModel.description"
        placeholder="Enter description (optional)"
      ></textarea>
    </div>

    <!-- Order -->
    <div class="mb-2">
      <label>Order</label>
      <input
        type="number"
        class="form-control"
        [(ngModel)]="addModel.order"
        min="1"
      />
    </div>

    <button class="btn btn-Action" (click)="addUnit()">Add Unit</button>
  </div>


  <!-- Update/Delete Table -->
  <div class="card p-3 mt-4 border">
    <h5>Units List</h5>

    <!-- Filter Subject -->
    <div class="mb-2">
      <label>Subject</label>
      <select 
        class="form-control"
        [(ngModel)]="filter.subjectId"
        (ngModelChange)="onFilterSubjectChange()">
        <option value="0" disabled>Select Subject</option>
        <option *ngFor="let sub of subjects" [value]="sub.id">
          {{ sub.subjectName }}
        </option>
      </select>
    </div>

    <!-- Filter Grade -->
    <div class="mb-2">
      <label>Grade</label>
      <select
        class="form-control"
        [(ngModel)]="filter.gradeId"
        (ngModelChange)="onFilterGradeChange()">
        <option value="0" disabled>Select Grade</option>
        <option *ngFor="let grade of grades" [value]="grade.id">
          {{ grade.gradeName }}
        </option>
      </select>
    </div>

    <!-- Filter Term -->
    <div class="mb-2">
      <label>Term</label>
      <select
        class="form-control"
        [(ngModel)]="filter.termId"
        (ngModelChange)="loadUnits()">
        <option value="0" disabled>Select Term</option>
        <option *ngFor="let term of terms" [value]="term.id">
          {{ term.termOrder === 0 ? 'First Term' : 'Second Term' }}
        </option>
      </select>
    </div>


    <!-- Units table -->
    <table class="table table-bordered mt-3" *ngIf="units.length">
      <thead>
        <tr>
          <th>Title</th>
          <th>Description</th>
          <th>Order</th>
          <th>Actions</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let u of units">
          <ng-container *ngIf="editId === u.id; else viewRow">
            <td><input class="form-control" [(ngModel)]="u.title" /></td>
            <td><input class="form-control" [(ngModel)]="u.description" /></td>
            <td><input type="number" class="form-control" [(ngModel)]="u.order" /></td>

            <td>
              <button class="btn btn-success btn-sm" (click)="saveEdit(u)">✔</button>
              <button class="btn btn-secondary btn-sm" (click)="cancelEdit()">✖</button>
            </td>
          </ng-container>

          <ng-template #viewRow>
            <td>{{ u.title }}</td>
            <td>{{ u.description }}</td>
            <td>{{ u.order }}</td>
            <td>
              <button class="btn btn-primary btn-sm" (click)="enableEdit(u.id)">Edit</button>
              <button class="btn btn-danger btn-sm" (click)="deleteUnit(u.id)">Delete</button>
            </td>
          </ng-template>
        </tr>
      </tbody>
    </table>

    <div *ngIf="units.length==0" class="alert alert-info mt-3">
      No units found for selected filters.
    </div>
  </div>
</div>
