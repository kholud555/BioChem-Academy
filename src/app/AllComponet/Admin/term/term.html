<!-- Add Term Form -->
<div class="container-custom">
  <div class="card p-3 mt-4 border">
    <h5>Add New Term</h5>

    <!-- Select Subject -->
    <div class="mb-2">
      <label>Select Subject</label>
      <select 
        class="form-control" 
        [(ngModel)]="newTerm.subjectId"
        (ngModelChange)="onSubjectChange()">
        <option value="0" disabled>Select Subject</option>
        <option *ngFor="let sub of subjects" [value]="sub.id">
          {{ sub.subjectName }}
        </option>
      </select>
    </div>

   <!-- Select Grade -->
<select 
  class="form-control" 
  [(ngModel)]="selectedGradeId"
  (ngModelChange)="newTerm.gradeId = $event; onGradeChange()">
  <option value="0" disabled>Select Grade</option>
  <option *ngFor="let grade of grades" [value]="grade.id">
    {{ grade.gradeName }}
  </option>
</select>


    <!-- Term Name -->
    <div class="mb-2">
      <label>Term Name</label>
      <select class="form-control" [(ngModel)]="newTerm.termOrder">
        <option [ngValue]="0">First Term</option>
        <option [ngValue]="1">Second Term</option>
      </select>
    </div>

    <button class="btn btn-Action" (click)="addNewTerm()">Add Term</button>
  </div>

  <!-- Update/Delete Section -->
  <div class="card p-3 mt-4 border">
    <h5>Update And Delete Term</h5>

    <!-- Select Grade -->
       <div class="mb-2">
      <label>Select Subject</label>
      <select 
        class="form-control" 
        [(ngModel)]="newTerm.subjectId"
        (ngModelChange)="onSubjectChange()">
        <option value="0" disabled>Select Subject</option>
        <option *ngFor="let sub of subjects" [value]="sub.id">
          {{ sub.subjectName }}
        </option>
      </select>
    </div>
    <div class="mb-2">
      <label>Select Grade</label>
      <select 
        class="form-control" 
        [(ngModel)]="selectedGradeId"
        (ngModelChange)="onGradeChange()">
        <option value="0" disabled>Select Grade</option>
        <option *ngFor="let grade of grades" [value]="grade.id">{{ grade.gradeName }}</option>
      </select>
    </div>

    <!-- Show Terms Table -->
    <div *ngIf="terms.length > 0" class="mt-4">
      <h5>Terms for Selected Grade</h5>
      <table class="table table-hover table-bordered">
        <thead>
          <tr>
            <th>Term Name</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let term of terms">
            <!-- Edit Mode -->
            <ng-container *ngIf="editingTermId === term.id; else viewMode">
              <td>
                <select class="form-control" [(ngModel)]="editedTerm.termOrder">
                  <option [ngValue]="0">First Term</option>
                  <option [ngValue]="1">Second Term</option>
                </select>
              </td>
              <td>
                <div class="action-buttons">
                  <button class="btn btn-success btn-sm me-1" (click)="updateTerm()">
                    <i class="bi bi-check-lg"></i>
                  </button>
                  <button class="btn btn-secondary btn-sm" (click)="cancelEdit()">
                    <i class="bi bi-x-lg"></i>
                  </button>
                </div>
              </td>
            </ng-container>

            <!-- View Mode -->
            <ng-template #viewMode>
              <td>{{ term.termOrder === 0 ? 'First Term' : 'Second Term' }}</td>
              <td>
                <button class="btn-action btn-edit" (click)="startEdit(term)">
                  <i class="bi bi-pencil-square"></i>
                </button>
                <button class="btn-action btn-delete" (click)="deleteTerm(term.id)">
                  <i class="bi bi-trash-fill"></i>
                </button>
              </td>
            </ng-template>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- No Terms Message -->
    <div *ngIf="selectedGradeId > 0 && terms.length === 0" class="alert alert-info mt-3">
      No terms found for the selected grade.
    </div>
  </div>
</div>
