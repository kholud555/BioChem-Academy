<app-nav-bar></app-nav-bar>

<div class="container mt-4" (contextmenu)="disableRightClick($event)">
  <h2 class="page-title text-center">ğŸ“š Lesson Content</h2>
  <h3 class="lesson-title">{{SelectLesson?.title}}</h3>

  <!-- ===== MEDIA SECTION ===== -->
  <div class="row g-4 media-grid" *ngIf="!ExamStarted && !showResult && mediaList.length > 0">
    
    <div class="col-sm-6 col-md-4 col-lg-3" *ngFor="let media of mediaList">
      <div class="content-card shadow-sm">

        <div class="card-media">
          
          <!-- IMAGE -->
          <img 
            *ngIf="media.mediaType === 'Image'" 
            [src]="media.previewUrl" 
            class="media-img"
          />

          <!-- VIDEO -->
          <div *ngIf="media.mediaType === 'Video'" class="video-wrapper">
            <video
              controls
              class="media-video"
              controlsList="nodownload noplaybackrate"
              disablePictureInPicture
              oncontextmenu="return false;"
            >
              <source [src]="media.previewUrl" type="video/mp4" />
            </video>
          </div>

          <!-- PDF -->
          <img *ngIf="media.mediaType === 'Pdf'" src="assets/pdf-icon.png" class="media-img" />

          <!-- AUDIO -->
          <audio *ngIf="media.mediaType === 'Audio'" controls class="w-100" controlsList="nodownload">
            <source [src]="media.previewUrl" type="audio/mpeg">
          </audio>
        </div>

        <div class="card-body text-center">
          <h5 class="file-title">{{ media.fileName }}</h5>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="mediaList.length === 0" class="no-media text-center">
    <p>No content available for this lesson.</p>
  </div>
</div>

<!-- =================== EXAMS =================== -->
<div class="container mt-5">

  <h2 class="section-title" *ngIf="!ExamStarted && !showResult">ğŸ“ Exams</h2>

  <!-- Exam list -->
  <div *ngIf="!ExamStarted && !showResult" class="exam-section">
    <div class="row g-3">
      <div *ngFor="let exam of exams" class="col-md-6 col-lg-4">
        <div class="exam-card shadow rounded">
          <h5 class="exam-title">{{ exam.title }}</h5>
          <p class="exam-desc">Test your knowledge ğŸ¯</p>

          <button class="btn btn-primary w-100" (click)="startExam(exam.id, exam.title)">
            Start Exam
          </button>
        </div>
      </div>
    </div>

    <p *ngIf="exams.length === 0" class="no-exams">No exams available.</p>
  </div>


  <!-- =================== QUESTIONS =================== -->
  <div *ngIf="ExamStarted" class="questions-area">
    <h4 class="exam-header">{{ selectedExamTitle }}</h4>

    <div *ngFor="let question of examQuestions" class="question-card">

      <p class="question-text">
        <strong>{{ question.questionHeader }}</strong>
        <span class="mark">({{ question.mark }} Mark)</span>
      </p>

      <ul class="choices-list">
        <li *ngFor="let choice of question.choicesOfQuestion" class="choice-item">
          <input 
            type="radio"
            [name]="'q' + question.id"
            [value]="choice.id"
            (change)="selectAnswer(question.id, choice.id)"
          />
          {{ choice.choiceText }}
        </li>
      </ul>
    </div>

    <button class="btn btn-success submit-btn" (click)="submitExam()" [disabled]="submitting">
      {{ submitting ? 'Submitting...' : 'Submit Exam' }}
    </button>
  </div>


  <!-- =================== RESULT =================== -->
  <div *ngIf="showResult" class="result-card shadow-lg">
    <h2 class="result-title">ğŸ‰ Exam Completed!</h2>
    <h4>{{ selectedExamTitle }}</h4>

    <div class="score-display">
      {{ totalScore }} / {{ maxScore }}
    </div>

    <div class="percentage-display">
      Percentage: <strong>{{ getPercentage() }}%</strong>
    </div>

    <div class="progress result-progress">
      <div class="progress-bar"
        [style.width.%]="getPercentage()"
        [ngClass]="{
          'bg-success': getPercentage() >= 60,
          'bg-warning': getPercentage() >= 40 && getPercentage() < 60,
          'bg-danger': getPercentage() < 40
        }">
        {{ getPercentage() }}%
      </div>
    </div>

    <p class="result-msg" 
      [ngClass]="{
        'text-success': getPercentage() >= 60,
        'text-danger': getPercentage() < 60
      }">
      {{ getPercentage() >= 60 ? 'Congratulations! You Passed!' : 'You need more practice.' }}
    </p>

    <button class="btn btn-primary btn-lg" (click)="closeResult()">Back to course</button>
  </div>
</div>
