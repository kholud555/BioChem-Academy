<div class="container-custom">

  <!-- Add Lesson -->
  <div class="card p-3 mt-4 border">
    <h5 class="mb-3">Add New Lesson</h5>

    <!-- Select Subject -->
    <div class="mb-2">
      <label>Select Subject</label>
      <select 
        class="form-control"
        [(ngModel)]="selectedSubjectId"
        (ngModelChange)="onSubjectChange()">

        <option value="0" disabled>Select Subject</option>
        <option *ngFor="let sub of subjects" [value]="sub.id">
          {{ sub.subjectName }}
        </option>
      </select>
    </div>

    <!-- Select Grade -->
    <div class="mb-2">
      <label>Select Grade</label>
      <select 
        class="form-control"
        [(ngModel)]="selectedGradeId"
        (ngModelChange)="onGradeChange()">

        <option value="0" disabled>Select Grade</option>
        <option *ngFor="let grade of grades" [value]="grade.id">
          {{ grade.gradeName }}
        </option>
      </select>
    </div>

    <!-- Select Term -->
    <div class="mb-2">
      <label>Select Term</label>
      <select 
        class="form-control"
        [(ngModel)]="selectedTermId"
        (ngModelChange)="onTermChange()">

        <option value="0" disabled>Select Term</option>
        <option *ngFor="let term of terms" [value]="term.id">
          {{ term.termOrder === 0 ? "First Term" : "Second Term" }}
        </option>
      </select>
    </div>

    <!-- Select Unit -->
    <div class="mb-2">
      <label>Select Unit</label>
      <select 
        class="form-control"
        [(ngModel)]="selectedUnitId"
        (ngModelChange)="onUnitChange()">

        <option value="0" disabled>Select Unit</option>
        <option *ngFor="let unit of units" [value]="unit.id">
          {{ unit.title }}
        </option>
      </select>
    </div>

    <!-- Lesson Title -->
    <div class="mb-2">
      <label>Lesson Title</label>
      <input 
        type="text" 
        class="form-control"
        [(ngModel)]="newLesson.title"
        placeholder="Enter Lesson Title">
    </div>

    <!-- Description -->
    <div class="mb-2">
      <label>Description (optional)</label>
      <textarea 
        class="form-control"
        [(ngModel)]="newLesson.description"
        placeholder="Enter description"></textarea>
    </div>

    <!-- Order -->
    <div class="mb-2">
      <label>Order</label>
      <input 
        type="number" 
        class="form-control"
        min="1"
        [(ngModel)]="newLesson.order">
    </div>

    <button class="btn btn-Action" (click)="addLesson()">Add Lesson</button>
  </div>


  <!-- Update & Delete Lessons -->
  <div class="card p-3 mt-4 border">
    <h5 class="mb-3">Update / Delete Lessons</h5>

    <!-- Same Filters -->
    <div class="mb-2">
      <label>Select Subject</label>
      <select 
        class="form-control"
        [(ngModel)]="selectedSubjectId"
        (ngModelChange)="onSubjectChange()">
        <option value="0" disabled>Select Subject</option>
        <option *ngFor="let sub of subjects" [value]="sub.id">{{ sub.subjectName }}</option>
      </select>
    </div>

    <div class="mb-2">
      <label>Select Grade</label>
      <select 
        class="form-control"
        [(ngModel)]="selectedGradeId"
        (ngModelChange)="onGradeChange()">
        <option value="0" disabled>Select Grade</option>
        <option *ngFor="let grade of grades" [value]="grade.id">{{ grade.gradeName }}</option>
      </select>
    </div>

    <div class="mb-2">
      <label>Select Term</label>
      <select 
        class="form-control"
        [(ngModel)]="selectedTermId"
        (ngModelChange)="onTermChange()">
        <option value="0" disabled>Select Term</option>
        <option *ngFor="let term of terms" [value]="term.id">
          {{ term.termOrder === 0 ? "First Term" : "Second Term" }}
        </option>
      </select>
    </div>

    <div class="mb-2">
      <label>Select Unit</label>
      <select 
        class="form-control"
        [(ngModel)]="selectedUnitId"
        (ngModelChange)="onUnitChange()">
        <option value="0" disabled>Select Unit</option>
        <option *ngFor="let unit of units" [value]="unit.id">
          {{ unit.title }}
        </option>
      </select>
    </div>

    <!-- Lessons Table -->
    <div *ngIf="lessons.length > 0" class="mt-3">
      <table class="table table-bordered table-hover">
        <thead>
          <tr>
            <th>Title</th>
            <th>Description</th>
            <th>Order</th>
            <th class="text-center">Actions</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let lesson of lessons">

            <!-- Edit Mode -->
            <ng-container *ngIf="selectedLessonId === lesson.id; else viewRow">
              <td><input class="form-control" [(ngModel)]="lesson.title"></td>
              <td><input class="form-control" [(ngModel)]="lesson.description"></td>
              <td><input type="number" class="form-control" [(ngModel)]="lesson.order"></td>

              <td class="text-center">
                <button class="btn btn-success btn-sm" (click)="saveEdit(lesson)">
                  <i class="bi bi-check-lg"></i>
                </button>
                <button class="btn btn-secondary btn-sm" (click)="cancelEdit()">
                  <i class="bi bi-x-lg"></i>
                </button>
              </td>
            </ng-container>

            <!-- View Mode -->
            <ng-template #viewRow>
              <td>{{ lesson.title }}</td>
              <td>{{ lesson.description }}</td>
              <td>{{ lesson.order }}</td>

              <td class="text-center">
                <button class="btn-action btn-edit" (click)="enableEdit(lesson.id)">
                  <i class="bi bi-pencil-square"></i>
                </button>
                <button class="btn-action btn-delete" (click)="deleteLesson(lesson.id)">
                  <i class="bi bi-trash-fill"></i>
                </button>
              </td>
            </ng-template>

          </tr>
        </tbody>
      </table>
    </div>

    <!-- No Lessons  -->
    <div
      *ngIf="selectedUnitId > 0 && lessons.length === 0"
      class="alert alert-info mt-3">
      No lessons found for this unit.
    </div>

  </div>

</div>
